
use 'libs/tests/common.baabnq';

"library has to run, to define consts
lab fInit;
use 'libs/float.baabnq';
return;


"check constants
lab TestFloats::Const;
    sub fInit;

    "shared consts
    jump fail ~ _upper16 != 65280;
    jump fail ~ _posNaN != 16256;
    jump fail ~ _FpZero != 16384;    

    "system consts
    jump fail ~ _MANTISSA_SIZE != 8;
    jump fail ~ _EXPONENT_SIZE != 8;
    jump fail ~ _SIGN_SIZE     != 15;

    jump fail ~ _MANTISSA_MASK != 127;
    jump fail ~ _EXPONENT_MASK != 255;
    jump fail ~ _SIGN_MASK     != 32768;

    jump fail ~ _MIN_SIGNED_CHAR != 128;

    jump succ;

lab TestFloats::GetMantissa;
    sub fInit;
    
    "msb is implied to save space    
    push 0;
    sub Floats::GetMantissa;
    pull _v;
    jump fail ~ _v != 128;

    push 127;
    sub Floats::GetMantissa;
    pull _v;
    jump fail ~ _v != 128 | 127;
    
    jump succ;


lab TestFloats::GetExponent;
    sub fInit;
    
    "zero should be zero
    push 0 << 7; "<< 7 for symmetry
    sub Floats::GetExponent;
    pull _v;
    jump fail ~ _v != 0;

    "!zero should be !zero (>> 7)
    push 255 << 7;
    sub Floats::GetExponent;
    pull _v;
    jump fail ~ _v != 255;
    
    jump succ;



    